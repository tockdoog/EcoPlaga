# ğŸ”„ Flujo de Funcionamiento - EcoPlaga

Este documento describe el flujo completo del sistema EcoPlaga, incluyendo la arquitectura, base de datos y flujos de usuario.

---

## ğŸ“‹ Tabla de Contenidos

1. [Arquitectura del Sistema](#arquitectura-del-sistema)
2. [Flujo de AutenticaciÃ³n](#flujo-de-autenticaciÃ³n)
3. [Estructura de la Base de Datos](#estructura-de-la-base-de-datos)
4. [Flujos de Usuario](#flujos-de-usuario)
5. [Flujo de AnÃ¡lisis de Datos](#flujo-de-anÃ¡lisis-de-datos)

---

## ğŸ—ï¸ Arquitectura del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (Cliente)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HTML5   â”‚  â”‚   CSS3   â”‚  â”‚JavaScriptâ”‚  â”‚ Fetch APIâ”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚ HTTP/HTTPS
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND (FastAPI)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Routers                            â”‚   â”‚
â”‚  â”‚  /auth  /cultivos  /plagas  /incidencias  /tratam... â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   Servicios                           â”‚   â”‚
â”‚  â”‚  - AnÃ¡lisis de Plagas (Pandas/Numpy)                 â”‚   â”‚
â”‚  â”‚  - Recomendaciones                                    â”‚   â”‚
â”‚  â”‚  - ExportaciÃ³n de Datos                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                â–¼                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                 Models (ORM)                          â”‚   â”‚
â”‚  â”‚  User, Cultivo, Plaga, Incidencia, Tratamiento       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ SQLAlchemy
                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BASE DE DATOS                               â”‚
â”‚               SQLite / PostgreSQL                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚users â”‚  â”‚cultivosâ”‚  â”‚plagas â”‚  â”‚incidencias â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚                  â”‚tratamientos â”‚                            â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Componentes Principales

**Frontend:**
- PÃ¡ginas HTML con templates Jinja2
- CSS moderno con diseÃ±o responsive
- JavaScript vanilla para interactividad
- Fetch API para comunicaciÃ³n asÃ­ncrona

**Backend:**
- FastAPI como framework web
- SQLAlchemy como ORM
- Pydantic para validaciÃ³n
- JWT para autenticaciÃ³n
- Pandas/Numpy para anÃ¡lisis

**Base de Datos:**
- SQLite para desarrollo
- PostgreSQL compatible para producciÃ³n
- 5 tablas principales relacionadas


## ğŸ—„ï¸ Estructura de la Base de Datos

### Diagrama ER (Entity-Relationship)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     users       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚
â”‚ name            â”‚
â”‚ email (UNIQUE)  â”‚
â”‚ farm_name       â”‚
â”‚ password (hash) â”‚
â”‚ created_at      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (registra)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    cultivos     â”‚          â”‚     plagas      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)         â”‚          â”‚ id (PK)         â”‚
â”‚ nombre          â”‚          â”‚ nombre          â”‚
â”‚ tipo            â”‚          â”‚ descripcion     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                            â”‚
         â”‚ (afecta)                   â”‚ (detectada en)
         â”‚             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚             â”‚
         â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       incidencias           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                     â”‚
â”‚ cultivo_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ cultivos.id
â”‚ plaga_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ plagas.id
â”‚ descripcion                 â”‚
â”‚ severidad                   â”‚
â”‚ fecha                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â”‚ (genera)
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       tratamientos          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id (PK)                     â”‚
â”‚ plaga_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â†’ plagas.id
â”‚ descripcion                 â”‚
â”‚ fecha                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### DescripciÃ³n de Tablas

#### 1. **users** (Usuarios del sistema)
| Campo       | Tipo     | DescripciÃ³n                    |
|-------------|----------|--------------------------------|
| id          | Integer  | ID Ãºnico (PK)                  |
| name        | String   | Nombre completo                |
| email       | String   | Email (Ãºnico)                  |
| farm_name   | String   | Nombre de la finca             |
| password    | String   | Password hasheado con bcrypt   |
| created_at  | DateTime | Fecha de registro              |

#### 2. **cultivos** (Cultivos registrados)
| Campo  | Tipo    | DescripciÃ³n                           |
|--------|---------|---------------------------------------|
| id     | Integer | ID Ãºnico (PK)                         |
| nombre | String  | Nombre del cultivo (ej: MaÃ­z)         |
| tipo   | String  | Tipo (Cereal, Hortaliza, Fruta, etc.) |

#### 3. **plagas** (CatÃ¡logo de plagas)
| Campo       | Tipo    | DescripciÃ³n                    |
|-------------|---------|--------------------------------|
| id          | Integer | ID Ãºnico (PK)                  |
| nombre      | String  | Nombre de la plaga             |
| descripcion | String  | DescripciÃ³n y caracterÃ­sticas  |

#### 4. **incidencias** (Registro de plagas detectadas)
| Campo       | Tipo     | DescripciÃ³n                           |
|-------------|----------|---------------------------------------|
| id          | Integer  | ID Ãºnico (PK)                         |
| cultivo_id  | Integer  | FK â†’ cultivos.id                      |
| plaga_id    | Integer  | FK â†’ plagas.id                        |
| descripcion | String   | Detalles de la incidencia             |
| severidad   | String   | Baja / Media / Alta / CrÃ­tica         |
| fecha       | DateTime | Fecha de detecciÃ³n                    |

#### 5. **tratamientos** (Tratamientos aplicados)
| Campo       | Tipo     | DescripciÃ³n                  |
|-------------|----------|------------------------------|
| id          | Integer  | ID Ãºnico (PK)                |
| plaga_id    | Integer  | FK â†’ plagas.id               |
| descripcion | String   | DescripciÃ³n del tratamiento  |
| fecha       | DateTime | Fecha de aplicaciÃ³n          |

### Relaciones

- **users** â†’ (registra) â†’ **cultivos** *(implÃ­cito por autenticaciÃ³n)*
- **cultivos** + **plagas** â†’ **incidencias** *(many-to-many)*
- **plagas** â†’ **tratamientos** *(one-to-many)*

---

## ğŸ‘¤ Flujos de Usuario

### 1. Flujo Principal de Uso

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          INICIO                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚ Â¿Usuario registrado? â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚
       NO                          SÃ
        â”‚                           â”‚
        â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   REGISTRO   â”‚            â”‚    LOGIN     â”‚
â”‚              â”‚            â”‚              â”‚
â”‚ 1. Nombre    â”‚            â”‚ 1. Email     â”‚
â”‚ 2. Email     â”‚            â”‚ 2. Password  â”‚
â”‚ 3. Finca     â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ 4. Password  â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
       â”‚                           â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    DASHBOARD    â”‚
              â”‚                 â”‚
              â”‚ - EstadÃ­sticas  â”‚
              â”‚ - GrÃ¡ficos      â”‚
              â”‚ - Alertas       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚               â”‚               â”‚
       â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CULTIVOS   â”‚ â”‚  PLAGAS  â”‚  â”‚  INCIDENCIAS   â”‚
â”‚             â”‚ â”‚          â”‚  â”‚                â”‚
â”‚ - Agregar   â”‚ â”‚ - CatÃ¡logoâ”‚ â”‚ - Registrar    â”‚
â”‚ - Listar    â”‚ â”‚ - CRUD   â”‚  â”‚ - Severidad    â”‚
â”‚ - Editar    â”‚ â”‚          â”‚  â”‚ - Filtrar      â”‚
â”‚ - Eliminar  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ - Exportar CSV â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  RECOMENDACIONES â”‚
              â”‚                  â”‚
              â”‚ - AnÃ¡lisis       â”‚
              â”‚ - Alertas        â”‚
              â”‚ - Sugerencias    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```



## ğŸ“Š Flujo de AnÃ¡lisis de Datos

### Pipeline de AnÃ¡lisis con Pandas/Numpy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATOS DE ENTRADA                         â”‚
â”‚                                                             â”‚
â”‚  Incidencias â†’ [                                            â”‚
â”‚    {id, cultivo_id, plaga_id, severidad, fecha, desc},     â”‚
â”‚    {id, cultivo_id, plaga_id, severidad, fecha, desc},     â”‚
â”‚    ...                                                      â”‚
â”‚  ]                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              PASO 1: CONVERSIÃ“N A DATAFRAME                 â”‚
â”‚                                                             â”‚
â”‚  df = pd.DataFrame(incidencias)                             â”‚
â”‚                                                             â”‚
â”‚  | id | cultivo_id | plaga_id | severidad | fecha | ...    â”‚
â”‚  |----|------------|----------|-----------|-------|----     â”‚
â”‚  | 1  | 5          | 2        | Alta      | 2024-...       â”‚
â”‚  | 2  | 3          | 2        | CrÃ­tica   | 2024-...       â”‚
â”‚  | 3  | 5          | 1        | Media     | 2024-...       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PASO 2: ANÃLISIS POR PLAGA                        â”‚
â”‚                                                             â”‚
â”‚  counts = df.groupby('plaga_id').size()                     â”‚
â”‚  by_severity = df.groupby(['plaga_id', 'severidad']).size()â”‚
â”‚                                                             â”‚
â”‚  Resultado:                                                 â”‚
â”‚  {                                                          â”‚
â”‚    "counts": {1: 15, 2: 23, 3: 8},                         â”‚
â”‚    "by_severity": {                                         â”‚
â”‚      1: {"Baja": 5, "Media": 7, "Alta": 3},                â”‚
â”‚      2: {"CrÃ­tica": 8, "Alta": 10, "Media": 5}             â”‚
â”‚    }                                                        â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PASO 3: ESTADÃSTICAS CON NUMPY                      â”‚
â”‚                                                             â”‚
â”‚  severidad_map = {"Baja": 1, "Media": 2, "Alta": 3, ...}   â”‚
â”‚  df['sev_num'] = df['severidad'].map(severidad_map)        â”‚
â”‚                                                             â”‚
â”‚  promedio = np.mean(df['sev_num'])                          â”‚
â”‚  desviacion = np.std(df['sev_num'])                         â”‚
â”‚  max_severidad = np.max(df['sev_num'])                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          PASO 4: ANÃLISIS DE TENDENCIAS                     â”‚
â”‚                                                             â”‚
â”‚  df['fecha'] = pd.to_datetime(df['fecha'])                  â”‚
â”‚  ultimos_7 = df[df['fecha'] >= hoy - 7 dÃ­as]               â”‚
â”‚  anteriores_7 = df[(fecha >= hoy-14) & (fecha < hoy-7)]    â”‚
â”‚                                                             â”‚
â”‚  cambio_% = ((len(ultimos_7) - len(anteriores_7))          â”‚
â”‚              / len(anteriores_7)) * 100                     â”‚
â”‚                                                             â”‚
â”‚  Tendencia: "aumento" si > 10%, "disminuciÃ³n" si < -10%    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         PASO 5: GENERACIÃ“N DE ALERTAS                       â”‚
â”‚                                                             â”‚
â”‚  Reglas:                                                    â”‚
â”‚  1. Si hay incidencias "CrÃ­tica" â†’ Alerta crÃ­tica          â”‚
â”‚  2. Si una plaga aparece > 5 veces â†’ Alerta frecuencia     â”‚
â”‚  3. Si cambio_% > 50% â†’ Alerta tendencia al alza           â”‚
â”‚  4. Si cultivos_afectados >= 3 â†’ Alerta propagaciÃ³n        â”‚
â”‚                                                             â”‚
â”‚  alertas = [                                                â”‚
â”‚    {"tipo": "critica", "mensaje": "..."},                   â”‚
â”‚    {"tipo": "frecuencia", "mensaje": "...", plaga_id: 2}   â”‚
â”‚  ]                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      PASO 6: GENERACIÃ“N DE RECOMENDACIONES                  â”‚
â”‚                                                             â”‚
â”‚  Para cada plaga:                                           â”‚
â”‚  - Contar severidades (crÃ­ticas, altas, medias, bajas)     â”‚
â”‚  - Determinar prioridad segÃºn reglas:                       â”‚
â”‚                                                             â”‚
â”‚    Si crÃ­ticas > 0:                                         â”‚
â”‚      â†’ Prioridad: "crÃ­tica"                                 â”‚
â”‚      â†’ AcciÃ³n: "ACCIÃ“N URGENTE"                             â”‚
â”‚      â†’ Tratamiento: "Intensivo inmediato"                   â”‚
â”‚                                                             â”‚
â”‚    Si altas >= 2:                                           â”‚
â”‚      â†’ Prioridad: "alta"                                    â”‚
â”‚      â†’ AcciÃ³n: "ALTA PRIORIDAD"                             â”‚
â”‚      â†’ Tratamiento: "QuÃ­mico especÃ­fico"                    â”‚
â”‚                                                             â”‚
â”‚  - Ordenar por prioridad                                    â”‚
â”‚  - Retornar lista priorizada                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                SALIDA FINAL AL FRONTEND                     â”‚
â”‚                                                             â”‚
â”‚  {                                                          â”‚
â”‚    "estadisticas": {...},                                   â”‚
â”‚    "alertas": [...],                                        â”‚
â”‚    "recomendaciones": [...],                                â”‚
â”‚    "tendencias": [...]                                      â”‚
â”‚  }                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Peticiones HTTP

### Ejemplo: Crear una Incidencia

```http
POST http://localhost:8000/incidencias/
Headers:
  Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
  Content-Type: application/json

Body:
{
  "cultivo_id": 5,
  "plaga_id": 2,
  "severidad": "Alta",
  "descripcion": "Pulgones en hojas superiores, aprox 30% afectado"
}

Response: 201 Created
{
  "id": 42,
  "cultivo_id": 5,
  "plaga_id": 2,
  "severidad": "Alta",
  "descripcion": "Pulgones en hojas superiores...",
  "fecha": "2024-12-11T10:30:00"
}
```

## ğŸ“¦ Resumen de Componentes

| Componente | TecnologÃ­a | Responsabilidad |
|------------|------------|-----------------|
| Frontend | HTML/CSS/JS | Interfaz de usuario |
| Router | FastAPI | Enrutamiento de peticiones |
| Schemas | Pydantic | ValidaciÃ³n de datos |
| Models | SQLAlchemy | Mapeo objeto-relacional |
| Services | Pandas/Numpy | AnÃ¡lisis de datos |
| Database | SQLite/PostgreSQL | Persistencia de datos |
| Auth | JWT + bcrypt | Seguridad y autenticaciÃ³n |

---

<div align="center">
  <p>ğŸ“Š Este documento describe el flujo completo del sistema EcoPlaga</p>
  <p>Para mÃ¡s informaciÃ³n, consulta el <a href="README.md">README.md</a></p>
</div>